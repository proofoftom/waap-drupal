import{initWaaP as n}from"@human.tech/waap-sdk";class o{constructor(t={}){this.config={authenticationMethods:["email","social"],allowedSocials:["google","twitter","discord"],...t},this.provider=null,this.account=null,this.chainId=null,this.listeners=new Map,this.lastNonce=null}async init(){if(!this.provider)try{if(n({config:this.config,useStaging:!1}),this.provider=window.waap,!this.provider)throw new Error("WaaP provider not available after initialization");this.attachEventListeners(),console.log("WaaP SDK initialized successfully")}catch(t){throw console.error("Failed to initialize WaaP SDK:",t),t}}attachEventListeners(){this.provider&&(this.provider.on("connect",t=>{this.chainId=t.chainId,this.notifyListeners("connect",t),console.log("Wallet connected:",t)}),this.provider.on("disconnect",t=>{this.account=null,this.chainId=null,this.notifyListeners("disconnect",t),console.log("Wallet disconnected:",t)}),this.provider.on("accountsChanged",t=>{t.length===0?(this.account=null,this.notifyListeners("disconnect",null)):(this.account=t[0],this.notifyListeners("accountChanged",t)),console.log("Accounts changed:",t)}),this.provider.on("chainChanged",t=>{this.chainId=t,this.notifyListeners("chainChanged",t),window.location.reload()}))}async checkSession(){this.provider||await this.init();try{const t=await this.provider.request({method:"eth_requestAccounts"});return t&&t.length>0?(this.account=t[0],console.log("Auto-connected with existing session:",this.account),this.account):null}catch{return console.log("No existing session found"),null}}async login(){this.provider||await this.init();try{const t=await this.provider.login();if(console.log("Login type:",t),t){const i=await this.provider.request({method:"eth_requestAccounts"});this.account=i[0]}return t}catch(t){throw console.error("Login failed:",t),t}}async signMessage(t){if(!this.provider||!this.account)throw new Error("Wallet not connected");try{const i=await this.provider.request({method:"personal_sign",params:[t,this.account]});return console.log("Message signed successfully"),i}catch(i){throw console.error("Message signing failed:",i),i}}getAddress(){return this.account}getChainId(){return this.chainId}isConnected(){return!!this.account}on(t,i){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(i)}off(t,i){if(!this.listeners.has(t))return;const s=this.listeners.get(t),e=s.indexOf(i);e>-1&&s.splice(e,1)}notifyListeners(t,i){this.listeners.has(t)&&this.listeners.get(t).forEach(s=>s(i))}async logout(){if(this.provider)try{await this.provider.logout(),this.account=null,this.chainId=null,console.log("Logged out successfully")}catch(t){console.error("Logout failed:",t)}}destroy(){this.provider&&this.provider.removeAllListeners(),this.listeners.clear(),this.provider=null,this.account=null,this.chainId=null}}window.WalletAuthConnector=o;
